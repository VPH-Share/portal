{% extends 'datasets/base.html' %}
{% load scs_extras %}
{% block stylesheets %}
    <link rel="stylesheet" href="/static/css/dataset.min.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="/static/css/jquery.dataTables.min.css"  type="text/css" media="screen" />
    <link rel="stylesheet" href="/static/css/dataTables.bootstrap.min.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="/static/css/datetimepicker.css" type="text/css" media="all" rel="stylesheet">

 {% endblock %}

{% block javascripts %}
    <script type="text/javascript" src="/static/js/dataset.js"></script>
    <script src="/static/js/jquery.dataTables.min.js"></script>
    <script src="/static/js/dataTables.bootstrap.min.js"></script>
    <script src="/static/js/jqBootstrapValidation.min.js"></script>
    <script src="/static/js/ICanHaz.min.js"></script>
    <script type="text/javascript" src="/static/js/bootstrap-datetimepicker.js"></script>
{% endblock %}

{% block extrahead %}
    <script src="/static/jquery-scrolltofixed-min.js"></script>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <!--[if IE 7]>
    <link rel="stylesheet" href="/static/font-awesome-ie7.min.css">
    <![endif]-->
    <script>
      $(function () {

          QueryBuilder.autoDiscover();

          $('.dataset-table').each(function () {
            $(this).dataTable({

                "dom": "<'row-fluid'<'span12'f>r>" + "<'row-fluid'<'span12'p>>" + "<'row-fluid'<'span12't>>",
                /*"data": dataSet,*/
                "columns": [
                    { "title": "" }
                ],
                "paging": true,
                "ordering": false,
                "info": false,
                "search": true,
                "scrollX": true,
                language: {
                    search: "<i class='icon-search'></i>",
                    paginate: {
                        previous: "«",
                        next: "»"
                    }
                }
            });
          });

          $('#myTab a').click(function (e) {
                e.preventDefault();
                $(this).tab('show');
          });
      }
      );
    </script>
{% endblock %}

{% block content %}
    <script id="numeric_options" type="text/html">
    <select class="inline operator">
      <option value="=">=</option>
      <option value="NOT=">not =</option>
      <option value=">=">=></option>
      <option value="<="><=</option>
      <option value="<"> < </option>
      <option value=">"> > </option>
      <option value="=--EMPTY">is empty</option>
      <option value="NOT=--EMPTY">is not empty</option>
    </select>
    </script>

     <script id="string_options" type="text/html">
     <select class="inline operator"><option value="=">=</option><option value="NOT=">not =</option><option value="STARTS WITH">starts with</option><option value="ENDS WITH">ends with</option><option VALUE="CONTAINS">contains</option><option value="DOES NOT START WITH">doesn't start with</option><option value="DOES NOT END WITH">doesn't end with</option><option value="DOES NOT CONTAIN">doesn't contain</option><option VALUE="=--EMPTY">is empty</option><option value="NOT=--EMPTY">is not empty</option></select>
    </script>

    <script id="inside_condition" type="text/html">
        <div class="inside-condition">
            <button type="button" class="close" data-dismiss="alert" data-toggle="tooltip" title="Remove operation" data-placement="right"  data-trigger="hover focus click" data-container="body">&times;</button>
            <div class="condition-form">
                <div class="inline left-node"> {% templatetag openbrace %}{% templatetag openvariable %} left_node {% templatetag closevariable %}{% templatetag closebrace %}</div>
                {% templatetag openbrace %}{% templatetag openvariable %} operations {% templatetag closevariable %}{% templatetag closebrace %}
                {% templatetag openbrace %}{% templatetag openvariable %} input {% templatetag closevariable %}{% templatetag closebrace %}
            </div>
            <div class="connector or"></div>
        </div>
    </script>

    <script id="condition" type="text/html">
        <div class="condition drop">
            <button type="button" class="close" data-dismiss="alert" data-toggle="tooltip" title="Remove condition" data-placement="right" data-trigger="hover focus click" data-container="body">&times;</button>
            <div class="connector and"></div>
        </div>
    </script>

    <script id="select" type="text/html">
      <div class="select {% templatetag openvariable %} id {% templatetag closevariable %} ">
          <button type="button" class="close" data-dismiss="alert" data-toggle="tooltip" title="Remove the selected column" data-placement="right"  data-trigger="hover focus click">&times;</button>
          <div class="condition-form">
                <div class="inline input"><i class="fa fa-columns"></i> {% templatetag openvariable %} name {% templatetag closevariable %}</div>
                <select class="inline operator" disabled><option value="rename"> rename as (optional) </option></select>
                <input type="text" step="any"  class="inline"  placeholder="insert the new name"/>
          </div>
      </div>
    </script>

    <script id="text_value" type="text/html">
        <input type="text" required class="inline"  placeholder="insert a text value" name="{% templatetag openvariable %} name {% templatetag closevariable %}" data-validation-required-message="Is requeired!"/>
    </script>
    <script id="integer_value" type="text/html">
        <input type="number" required class="inline"  placeholder="insert a number" name="{% templatetag openvariable %} name {% templatetag closevariable %}" data-validation-required-message="Is requeired!"/>
    </script>

    <script id="float_value" type="text/html">
        <input type="number" step="any" required class="inline"  placeholder="insert a number" name="{% templatetag openvariable %} name {% templatetag closevariable %}" data-validation-required-message="Is requeired!"/>
    </script>

    <script id="datetime_value" type="text/html">
        <div class="controls input-append date">
           <input readonly="" type="text" required name="{% templatetag openvariable %} name {% templatetag closevariable %}" data-validation-required-message="Is requeired!"/>
           <span class="add-on"><i class="icon-th"></i></span>
       </div>
    </script>

    <div class="well well-small well-white">
    <h1><i class="fa fa-database"></i> {{ dataset.metadata.name|title }}
    <div  class="btn-group " style="float: right">
      <button id="query_button" class="btn btn-info">Get the results</button>
      <button class="btn dropdown-toggle btn-info" data-toggle="dropdown">
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu">
        <li><a>Save the query</a></li>
      </ul>
    </div>
    </h1>
    <div id="query-builder" class="row-fluid">
        <div class="span4">
            <div class="accordion" id="accordion1">
                {% for tablename, columns in dataset.metadata.schema.items %}
                    <div class="accordion-group">
                        <div class="accordion-heading">
                          <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion1" href="#{{ tablename }}">
                            <i class="fa fa-table"></i> {{ tablename|title }}
                          </a>
                        </div>
                        <div id="{{ tablename }}" class="accordion-body collapse {% if forloop.counter0 == 0 %} in {% endif %}">
                            <div class="accordion-inner">
                                <table cellpadding="0" cellspacing="0" border="0" class="display dataset-table" >
                                    <tbody>
                                    {% for column in columns %}
                                        <tr><td><div id="{{ tablename }}-{{ column.0 }}-{{ column.1 }}" class="column" data-name="{{ column.0 }}" data-type="{{ column.1 }}"><i class="fa fa-columns"></i> {{ column.0|title }}</div></td></tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        <div class="span8">
            <ul class="nav nav-tabs" id="myTab">
              <li class="active"><a href="#select-columns">Select</a></li>
              <li><a href="#where">Where</a></li>
            </ul>

            <div class="tab-content">
              <div class="tab-pane active" id="select-columns">
                  <div class="alert alert-info">
                      <button type="button" class="close" data-dismiss="alert">&times;</button>
                      Select the columns which you want to have in your result table.
                      <hr>
                      If you leave empty, all the columns will be selected.
                  </div>
                  <div id="select-message-error" class="alert alert-error hide hideMe"></div>
                  <div class="select new-select drop">

                  </div>
              </div>
              <div class="tab-pane" id="where">
                    <p class="alert alert-info">
                       Move the columns here to filter your results.
                    </p>
                  <p id="where-message-error" class="alert alert-error hide hideMe"></p>
                    <div class="condition new-condition drop">
                        <div class="connector new-connector"></div>
                    </div>
              </div>
            </div>
        </div>
    </div>
    </div>

{% endblock %}