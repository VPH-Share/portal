(function(){var a,b,c;a=this;b=a.$;c=a.QueryBuilder=function(e,d){this.inizialize(e)};c.prototype.inizialize=function(d){var e=this;this.$columnsList={};this.$dropArea={select:[],where:[]};this.$query=[];this.$root=d;b("#query_button").click(function(){e.submit_query()});d.find("input,select,textarea").not("[type=submit]").jqBootstrapValidation();d.find(".column").each(function(g,h){var f=b(h);e.$columnsList[f.attr("id")]={name:f.data("name"),type:f.data("type")};f.draggable({revert:"invalid",revertDuration:200,zIndex:2500,cursor:"move",helper:"clone",appendTo:"body",cursorAt:{top:17,left:15},start:function(i,j){},drag:function(i,j){}})});d.find(".condition:not(.new-condition)").droppable({activeClass:"new-condition-active",hoverClass:"condition-hover",drop:function(f,g){e.drop_new_single_operation(f,g,b(this))}});d.find(".new-condition").droppable({activeClass:"new-condition-active",hoverClass:"condition-hover",drop:function(f,g){e.drop_new_condition(f,g,b(this))}});d.find(".new-select").droppable({activeClass:"new-condition-active",hoverClass:"condition-hover",drop:function(f,g){e.drop_new_select(f,g,b(this))}});d.find(".close").tooltip();d.find(".connector").click(e.changeConnector)};c.prototype.changeConnector=function(){var d=b(this);if(d.hasClass("and")){d.removeClass("and").addClass("or")}else{d.removeClass("or").addClass("and")}};c.drop_new_operation=function(e,d){if(e.find(".connector").length){e.children(".connector").before(d)}else{e.append(d)}};c.prototype.drop_new_single_operation=function(e,k,i){var n=this;var m=b(k.draggable).clone();var f=m.data("name");var j=m.data("type");var g=m.attr("id");var d="";var l="";if(b.inArray(j,["smallint","int","bigint"])>-1){d=ich.numeric_options()[0].outerHTML;l=ich.integer_value({name:f})[0].outerHTML}else{if(b.inArray(j,["double","float"])>-1){d=ich.numeric_options()[0].outerHTML;l=ich.float_value({name:f})[0].outerHTML}else{if(b.inArray(j,["date","time","dateTime"])>-1){d=ich.numeric_options()[0].outerHTML;l=ich.datetime_value({name:f})[0].outerHTML}else{d=ich.string_options()[0].outerHTML;l=ich.text_value({name:f})[0].outerHTML}}}var h=ich.inside_condition({left_node:m.html(),operations:d,input:l});h.find("select").change(function(){var o=b(this).val();if(b.inArray(o,["=--EMPTY","NOT=--EMPTY"])>-1){b(this).next().hide();b(this).next().val("none")}else{if(b(this).next()=="none"){b(this).next().val("")}b(this).next().show()}});if(j=="date"){h.find(".date").datetimepicker({clearBtn:false,autoclose:true,format:"dd/mm/yyyy hh:ii"})}else{if(j=="dateTime"){h.find(".date").datetimepicker({minView:2,autoclose:true,clearBtn:false,startView:2,format:"dd/mm/yyyy"})}else{if(j=="time"){h.find(".date").datetimepicker({minView:0,format:"hh:ii",clearBtn:false,maxView:1,autoclose:true,startView:1})}}}h.find("input,select,textarea").jqBootstrapValidation();h.data({name:f,type:j,id:g});c.drop_new_operation(i,h);h.find(".connector").click(n.changeConnector);b(".close").tooltip()};c.prototype.drop_new_condition=function(h,i,e){var f=this;var g=b(i.draggable).clone();var d=b(ich.condition());f.drop_new_single_operation(h,i,d);e.before(d);d.droppable({activeClass:"new-condition-active",hoverClass:"condition-hover",drop:function(j,k){f.drop_new_single_operation(j,k,d)}});d.children(".connector").click(f.changeConnector);b(".close").tooltip()};c.prototype.drop_new_select=function(d,h,i){var l=this;var j=b(h.draggable).clone();var e=j.data("name");var g=j.data("type");var f=j.attr("id");if(i.parent().find("."+f).length){j.remove();b("#select-message-error").text("This column is already in the select statement!").fadeIn().delay(5000).slideUp();return false}var k=b(ich.select({id:f,name:e}));k.data({name:e,type:g,id:f});i.before(k);k.find(".close").tooltip()};c.prototype.validation=function(){var d=this;var e=d.$root.find("input,select,textarea").jqBootstrapValidation("collectErrors");for(key in e){if(e[key].length){b("#where-message-error").text(key+" assignment error. Please check if the inserted value is missing or a wrong type value.").fadeIn().delay(5000).slideUp();b("#myTab a:last").tab("show");b("input[name="+key+"]").focus();return false}}return true};c.prototype.submit_query=function(){var d=this;d.$dropArea={select:[],where:[]};if(d.validation()){d.$root.find("#where > .condition:not(.new-condition)").each(function(g,h){var f=b(h);if(f.find(".inside-condition").length>0){var e="";if(f.children(".connector:visible").length>0){e=b(f.children(".connector:visible")[0]).hasClass("and")?"and":"or"}var i={group:[],connector:e};f.find(".inside-condition").each(function(){var j=b(this);i.group.push({name:j.data("name"),type:j.data("type"),operator:j.find(".operator:first").val(),value:j.find("input:first").val(),connector:j.children(".connector:visible").length>0?b(j.children(".connector:visible")[0]).hasClass("and")?"and":"or":""})});d.$dropArea.where.push(i)}});d.$root.find("#select-columns > .select:not(.new-select)").each(function(g,h){var e=b(h);var f;if(e.find(".condition-form").length>0){f={name:e.data("name"),type:e.data("type"),displayAs:e.find("input:first").val()};d.$dropArea.select.push(f)}})}};c.prototype.loadtables=function(){var d=this};c.autoDiscover=function(){var d=b("#query-builder");new c(d)}}).call(this);